{% extends "AdminPortal/partials/layout.njk" %}

{% block style %}
<link rel="stylesheet" href="{{config.baseUrl}}AdminPortal/assets/plugins/datatables/datatables.min.css">
<link rel="stylesheet" href="{{config.baseUrl}}AdminPortal/assets/plugins/bootstrap/css/buttons.dataTables.min.css">

{% endblock %}

        {% block body %}
        <div class="content container-fluid">
                <div class="page-header">
                   <div class="row align-items-center">
                      <div class="col">
                         <!-- {{studentMasterData|dump}} -->
                         <h3 class="page-title">Subjects</h3>
                         <ul class="breadcrumb">
                            <li class="breadcrumb-item"><a href="{{config.baseUrl+'admin/Subjects'}}">Dashboard</a></li>
                            <li class="breadcrumb-item active">Subjects</li>
                         </ul>
                      </div>
                      <div class="col-auto text-end float-end ms-auto">
                        
                         <a href="{{config.baseUrl}}Admin/subject/add" class="btn btn-primary"><i class="fas fa-plus"></i></a>
                      </div>


                      
                        <div class="row align-items-center">
                           <div class="col">
                              <div class="col-md-3" style="float: right;">
                                    <label> Select class </label>
                                    <select name="selectClass" id="selectCLassId" class="form-control">
                                       <option value="" selected>Please select class</option>
                                       {% for row in classes %}
                                        <option value="{{row.value}}">{{row.key}}</option>
                                       {% endfor %}
                                      
                                    </select>
                              </div>
                           </div>
                        </div>
                      
                   </div>
                </div>
                <div class="row">
                   <div class="col-sm-12">
                      <div class="card card-table">
                         <div class="card-body">
                            <div class="table-responsive">
                               <table class="table table-bordered table-hover table-center mb-0 datatable">
                                  <thead>
                                     <tr>
                                        <th class="text-end">Action</th>
                                        <th>Subject Name</th>
                                        <th>Class</th>
                                        <th>Subject Sequence</th>
                                        <th>Subject Just for Grade</th>
                                     </tr>
                                  </thead>
                                
                               </table>
                            </div>
                         </div>
                      </div>
                   </div>
                </div>
             </div>
        {% endblock %}

{% block script %}
      <script src="{{config.baseUrl}}AdminPortal/assets/plugins/datatables/datatables.min.js"></script>
      <script src="{{config.baseUrl}}AdminPortal/assets/plugins/datatables/dataTables.buttons.min.js"></script>
      <script src="{{config.baseUrl}}AdminPortal/assets/plugins/datatables/jszip.min.js"></script>

      <script src="{{config.baseUrl}}AdminPortal/assets/plugins/datatables/buttons.html5.min.js"></script>
      <script src="{{config.baseUrl}}AdminPortal/assets/plugins/datatables/buttons.print.min.js"></script>

      <!-- <script src="{{config.baseUrl}}AdminPortal/assets/js/script.js"></script> -->

      <script type="text/javascript">

      $(document).on('change','#selectCLassId', function(){
         callTable()
      });

         let tableIntance="";
         $(document).ready(function () {
            callTable()
         });

         function callTable(){
            if(tableIntance){
               tableIntance.destroy();
            }
            let studentClass = $('select[name="selectClass"]').val();

            var host = window.location.origin;
            console.log("-------------------- : "+host)
            tableIntance= $('.datatable').DataTable({
            "processing": true,
            "serverSide": true,
            "dom": 'Bfrtip',
            "lengthMenu": [ 10, 25, 50, 75, 100,200,500,1000,5000 ],
            "buttons": [
               'pageLength', 'copy', 'csv', 'excel', 'pdf', 'print'
            ],
            // "searching": false,
            "language": {
                     searchPlaceholder: "Search by name "
            },
            "ordering": false,
            "autoWidth": false,
            "pageLength": 10,
            "ajax":{
               "dataType": "json",
               "url":host + "/admin/subjects/getAllList",
               "method":"POST",
               "data":{"sclass":studentClass},
               "dataSrc":function(apiResponse){
                  console.log("==============888888888888================ : ",apiResponse)
                  return apiResponse.data;
               }
            }, 
            "columns": [
               { "data": "action",render: function (data, type, row) {
                     
                     return `<div class="actions">
                              
                               <a title="Update Details" href="${host+'/admin/subject/edit/'+row._id}" class="btn btn-sm bg-success-light me-2">
                                  <i class="fas fa-pen"></i>
                               </a>
                               <a title="Delete Record" href="javascript:void(0)" onclick="return deleteChk(this)" id="${row._id}" class="btn btn-sm bg-danger-light">
                                  <i class="fas fa-trash"></i>
                               </a>
                            </div>`;
                 }
                },
                { "data": "subjectname" ,  render: function (data, type, row) {
                     return ((row.subjectName)?row.subjectName:'');
                  }
               },
             
                { "data": "className",render: function (data, type, row) {
                  return ((row.selectClass)?row.selectClass:'');
                } },

                { "data": "subjectSequence" ,  render: function (data, type, row) {
                     return ((row.subjectSequence)?row.subjectSequence:'');
                  }
               },
             
                { "data": "justforgrade",render: function (data, type, row) {
                  return ((row.subjectJustForGrade)?row.subjectJustForGrade:'');
                } },

            ]
            });
         }

         function deleteChk(ths){
                  if(confirm("Are you sure you want to delete this?")){
                     let id = $(ths).attr("id");
                     console.log("===================== : "+window.origin)
                     window.location= window.origin+'/admin/subject/delete/'+id;
                  }
                  else{
                     return false;
                  }
            console.log("--------------------")
         }

       
         


      </script>
{% endblock %}




