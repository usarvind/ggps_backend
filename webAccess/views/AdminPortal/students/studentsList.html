{% extends "AdminPortal/partials/layout.njk" %}

{% block style %}
<link rel="stylesheet" href="{{config.baseUrl}}AdminPortal/assets/plugins/datatables/datatables.min.css">
<link rel="stylesheet" href="{{config.baseUrl}}AdminPortal/assets/plugins/bootstrap/css/buttons.dataTables.min.css">

{% endblock %}

        {% block body %}
        <div class="content container-fluid">
                <div class="page-header">
                   <div class="row align-items-center">
                      <div class="col">
                         <!-- {{studentMasterData|dump}} -->
                         <h3 class="page-title">Students</h3>
                         <ul class="breadcrumb">
                            <li class="breadcrumb-item"><a href="{{config.baseUrl+'admin/students'}}">Dashboard</a></li>
                            <li class="breadcrumb-item active">Students</li>
                         </ul>
                      </div>
                      <div class="col-auto text-end float-end ms-auto">
                        
                         <a href="{{config.baseUrl}}Admin/student/add" class="btn btn-primary"><i class="fas fa-plus"></i></a>
                      </div>


                      
                        <div class="row align-items-center">
                           <div class="col">
                              <div class="col-md-3" style="float: right;">
                                    <label> Select current class </label>

                                    <select name="selectClass" id="selectCLassId" class="form-control">
                                       <option value="" selected>Please select class</option>
                                       <option value="KG">KG</option>
                                       <option value="LKG">LKG</option>
                                       <option value="UKG">UKG</option>
                                       <option value="1">1st class</option>
                                       <option value="2">2nd class</option>   
                                       <option value="3">3rd class</option>
                                       <option value="4">4th class</option> 
                                       <option value="5">5th class</option>
                                       <option value="6">6th class</option>   
                                       <option value="7">7th class</option>
                                       <option value="8">8th class</option> 
                                       <option value="9">9th class</option>
                                       <option value="10">10th class</option>   
                                       <option value="11">11th class</option>
                                       <option value="12">12th class</option>
                                    </select>
                              </div>
                           </div>
                           
                        </div>
                      
                   </div>
                </div>
                <div class="row">
                   <div class="col-sm-12">
                      <div class="card card-table">
                         <div class="card-body">
                            <div class="table-responsive">
                               <table class="table table-bordered table-hover table-center mb-0 datatable">
                                  <thead>
                                     <tr>
                                        <th class="text-end">Action</th>
                                        <th>Status</th>
                                        <th>Reg. No</th>
                                        <th>Name</th>
                                         <th>C Class</th>
                                        <th>Profile</th>
                                        <th>TC Created</th>
                                        <th>DOB</th>
                                        <th>Parent Name</th>
                                        <th>Parent Mobile Number</th>
                                       
                                     </tr>
                                  </thead>
                                
                               </table>
                            </div>
                         </div>
                      </div>
                   </div>
                </div>
             </div>
        {% endblock %}

{% block script %}
      <script src="{{config.baseUrl}}AdminPortal/assets/plugins/datatables/datatables.min.js"></script>
      <script src="{{config.baseUrl}}AdminPortal/assets/plugins/datatables/dataTables.buttons.min.js"></script>
      <script src="{{config.baseUrl}}AdminPortal/assets/plugins/datatables/jszip.min.js"></script>

      <script src="{{config.baseUrl}}AdminPortal/assets/plugins/datatables/buttons.html5.min.js"></script>
      <script src="{{config.baseUrl}}AdminPortal/assets/plugins/datatables/buttons.print.min.js"></script>

      <!-- <script src="{{config.baseUrl}}AdminPortal/assets/js/script.js"></script> -->

      <script type="text/javascript">

      $(document).on('change','#selectCLassId', function(){
         callTable()
      });

         let tableIntance="";
         $(document).ready(function () {
            callTable()
         });

         function callTable(){
            if(tableIntance){
               tableIntance.destroy();
            }
            let studentClass = $('select[name="selectClass"]').val();

            var host = window.location.origin;
            console.log("-------------------- : "+host)
            tableIntance= $('.datatable').DataTable({
            "processing": true,
            "serverSide": true,
            "dom": 'Bfrtip',
            "lengthMenu": [ 10, 25, 50, 75, 100,200,500,1000,5000 ],
            "buttons": [
               'pageLength', 'copy', 'csv', 'excel', 'pdf', 'print'
            ],
            // "searching": false,
            "language": {
                     searchPlaceholder: "Search by name "
            },
            "ordering": false,
            "autoWidth": false,
            "pageLength": 10,
            "ajax":{
               "dataType": "json",
               "url":host + "/admin/studentMaster/getAllList",
               "method":"POST",
               "data":{"sclass":studentClass},
               "dataSrc":function(apiResponse){
                  console.log("==============888888888888================ : ",apiResponse)
                  return apiResponse.data;
               }
            }, 
            "columns": [
               { "data": "action",render: function (data, type, row) {
                     
                   //  <a title="View Record" href="javascript:void(0)" onclick="return show(this)" id="${row._id}" class="btn btn-sm bg-primary-light">
                              //     <i class="fas fa-eye"></i>
                              //  </a>
                     return `<div class="actions">
                              <a title="Deactive Student" href="javascript:void(0)" onclick="return deactive_student(this)" id="${row._id}" class="btn btn-sm bg-danger-light me-2">
                                  <i class="fas fa-power-off"></i>
                               </a>

                               <a title="Promote Student" href="javascript:void(0)" onclick="return promote_student(this)" id="${row._id}" account_status="${row.isAccountDeactive}" class="btn btn-sm bg-primary-light me-2">
                                  <i class="fas fa-cannabis"></i>
                               </a>
                             
                               <a title="Update Details" href="${host+'/admin/student/edit/'+row._id}" class="btn btn-sm bg-success-light me-2">
                                  <i class="fas fa-pen"></i>
                               </a>
                               <a title="Delete Record" href="javascript:void(0)" onclick="return deleteChk(this)" id="${row._id}" class="btn btn-sm bg-danger-light">
                                  <i class="fas fa-trash"></i>
                               </a>
                            </div>`;
                 }
                },
                { "data": "status" ,  render: function (data, type, row) {
                    return ((row.isAccountDeactive)?`<span style="color:red">Deactive</span>`:`<span style="color:green">Active</span>`);
                  }
               },
               { "data": "regNo" ,  render: function (data, type, row) {
                    return (row.regNo)?row.regNo:"";
                }
               },
               { "data": "fullname" ,  render: function (data, type, row) {
                    return row.firstName+" "+row.lastName;
                }
               },
                { "data": "currentClass",render: function (data, type, row) {
                  return ((row.currentClass)?row.currentClass:'');
                } },

                { "data": "profileImage" ,  render: function (data, type, row) {
                   if(row.studentImage){
                     return `<img src="${host+'/AdminPortal/student/'+row.studentImage}" width="48" height="48">`;
                   }else{
                      return "";
                   }
                    return row.firstName+" "+row.lastName;
                }
               },
               { "data": "TCStatus" ,  render: function (data, type, row) {
                  return ((row.isTCCreated)?'Yes':'No');

                }
               },

              

               { "data": "dob",render: function (data, type, row) {
                  return ((row.dob)?moment(row.dob).format('DD-MM-YYYY'):'-');
                } },
               { "data": "fatherName" },
               { "data": "fatherMobileNo"},
              
            ]
            });
         }

  
         function show(ths){
                  if(confirm("Are you sure you want to view this?")){
                     let id = $(ths).attr("id");
                     console.log("===================== : "+window.origin)
                     window.location= window.origin+'/admin/student/viewDetails/'+id;
                  }
                  else{
                     return false;
                  }
            console.log("--------------------")
         }

         function deleteChk(ths){
                  if(confirm("Are you sure you want to delete this?")){
                     let id = $(ths).attr("id");
                     console.log("===================== : "+window.origin)
                     window.location= window.origin+'/admin/student/delete/'+id;
                  }
                  else{
                     return false;
                  }
            console.log("--------------------")
         }

         function deactive_student(ths){
                  if(confirm("Are you sure you want to deactive student this?")){
                     let id = $(ths).attr("id");
                     console.log("===================== : "+window.origin)
                     window.location= window.origin+'/admin/student/deactive/'+id;
                  }
                  else{
                     return false;
                  }
            console.log("--------------------")
         }

         

         function promote_student(ths){
                  let accountStatus = $(ths).attr("account_status")
                  if(accountStatus=='true'){
                        $.toast({ heading: 'Error', text: `{{'Account deactivated can not promote it .' | safe }}`, position: 'top-right', icon: 'error' });
                        return false;
                  }else{
                     if(confirm("Are you sure you want to promote this student?")){
                        let id = $(ths).attr("id");
                        let obj={"id":id}
                        callDynamicModal('promote_modal',obj)
                     }
                     else{
                        return false;
                     }
                  }      
            console.log("--------------------")
      }

      </script>
{% endblock %}




